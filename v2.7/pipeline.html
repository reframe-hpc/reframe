

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The Regression Test Pipeline &mdash; ReFrame 2.7 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/banner.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="ReFrame 2.7 documentation" href="index.html"/>
        <link rel="next" title="ReFrame Tutorial" href="tutorial.html"/>
        <link rel="prev" title="Configuring ReFrame for Your Site" href="configure.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
    

          
            <a href="index.html" class="icon icon-home"> ReFrame
          

          
          </a>

          
            
            
              <div class="version">
                2.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure.html">Configuring ReFrame For Your Site</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The Regression Test Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-initialization-phase">0. The Initialization Phase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-setup-phase">1. The Setup Phase</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#set-up-and-load-the-test-s-environment">Set up and load the test's environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-the-test-s-paths">Setup the test's paths</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prepare-a-job-for-the-test">Prepare a job for the test</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-compilation-phase">2. The Compilation Phase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-run-phase">3. The Run Phase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-sanity-checking-phase">4. The Sanity Checking Phase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-performance-checking-phase">5. The Performance Checking Phase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-cleanup-phase">6. The Cleanup Phase</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">ReFrame Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Customizing Further A Regression Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="deferrables.html">Understanding The Mechanism Of Sanity Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running ReFrame</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecases.html">Use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About ReFrame</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="sanity_functions_reference.html">Sanity Functions Reference</a></li>
</ul>

            
          
    <hr>
    <p class="caption">
      <span class="caption-text">Useful Links</span>
    </p>
    <ul>
      <li class="toctree-l1"><a class="reference internal" href="http://www.cscs.ch" target="_blank">CSCS</a></li>
      <li class="toctree-l1"><a class="reference internal" href="http://www.ethz.ch" target="_blank">ETH Zurich</a></li>
    </ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ReFrame</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <div style="text-align: center; margin-bottom: -1.5em; display: block">ReFrame 2.7</div>
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>The Regression Test Pipeline</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/eth-cscs/reframe" class="fa fa-github"> View on GitHub</a>
          
            <!-- <a href="https://eth-cscs.github.io/reframe">ReFrame</a> -->
            <!-- <a href="Section_commands.html#comm">Commands</a> -->
        
      </li>
  </ul>
  <hr/>
  
    <div class="rst-footer-buttons" style="margin-bottom: 1em" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial.html" class="btn btn-neutral float-right" title="ReFrame Tutorial" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configure.html" class="btn btn-neutral" title="Configuring ReFrame for Your Site" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-regression-test-pipeline">
<span id="the-regression-test-pipeline"></span><h1>The Regression Test Pipeline<a class="headerlink" href="#the-regression-test-pipeline" title="Permalink to this headline">¶</a></h1>
<p>The backbone of the ReFrame regression framework is the regression test pipeline.
This is a set of well defined phases that each regression test goes through during its lifetime.
The figure below depicts this pipeline in detail.</p>
<div style="text-align:center">
![The regression test pipeline.](_static/img/pipeline.svg)
</div><p>A regression test starts its life after it has been instantiated by the framework.
This is where all the basic information of the test is set.
At this point, although it is initialized, the regression test is not yet <em>live</em>, meaning that it does not run yet.
The framework will then go over all the loaded and initialized checks (we will talk about the loading and selection phases later), it will pick the next partition of the current system and the next programming environment for testing and will try to run the test.
If the test supports the current system partition and the current programming environment, it will be run and it will go through all the following seven phases:</p>
<ol class="simple">
<li>Setup</li>
<li>Compilation</li>
<li>Running</li>
<li>Sanity checking</li>
<li>Performance checking</li>
<li>Cleanup</li>
</ol>
<p>A test may implement some of them as no-ops.
As soon as the test is finished, its resources are cleaned up and the framework's environment is restored.
ReFrame will try to repeat the same procedure on the same regression test using the next programming environment and the next system partition until no further environments and partitions are left to be tested.
In the following we elaborate on each of the individual phases of the lifetime of a regression test.</p>
<div class="section" id="the-initialization-phase">
<span id="the-initialization-phase"></span><h2>0. The Initialization Phase<a class="headerlink" href="#the-initialization-phase" title="Permalink to this headline">¶</a></h2>
<p>This phase is not part of the regression test pipeline as shown above, but it is quite important, since during this phase the test is loaded into memory and initialized.
As we shall see in the <a class="reference external" href="tutorial.html">&quot;Tutorial&quot;</a> and in the <a class="reference external" href="advanced.html">&quot;Customizing Further A ReFrame Regression Test&quot;</a> sections, this is the phase where the <em>specification</em> of a test is set.
At this point the current system is already known and the test may be set up accordingly.
If no further differentiation is needed depending on the system partition or the programming environment, the test could go through the whole pipeline performing all of its work without the need to override any of the other pipeline stages.
In fact, this is perhaps the most common case for most of the regression tests.</p>
</div>
<div class="section" id="the-setup-phase">
<span id="the-setup-phase"></span><h2>1. The Setup Phase<a class="headerlink" href="#the-setup-phase" title="Permalink to this headline">¶</a></h2>
<p>A regression test is instantiated once by the framework and it is then copied each time a new system partition or programming environment is tried.
This first phase of the regression pipeline serves the purpose of preparing the test to run on the specified partition and programming environment by performing a number of operations described below:</p>
<div class="section" id="set-up-and-load-the-test-s-environment">
<span id="set-up-and-load-the-test-s-environment"></span><h3>Set up and load the test's environment<a class="headerlink" href="#set-up-and-load-the-test-s-environment" title="Permalink to this headline">¶</a></h3>
<p>At this point the environment of the current partition, the current programming environment and any test's specific environment will be loaded.
For example, if the current partition requires <code class="docutils literal"><span class="pre">slurm</span></code>, the current programming environment is <code class="docutils literal"><span class="pre">PrgEnv-gnu</span></code> and the test requires also <code class="docutils literal"><span class="pre">cudatoolkit</span></code>, this phase will be equivalent to the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>module load slurm
module unload PrgEnv-cray
module load PrgEnv-gnu
module load cudatoolkit
</pre></div>
</div>
<p>Note that the framework automatically detects conflicting modules and unloads them first.
So the user need not to care about the existing environment at all.
She only needs to specify what is needed by her test.</p>
</div>
<div class="section" id="setup-the-test-s-paths">
<span id="setup-the-test-s-paths"></span><h3>Setup the test's paths<a class="headerlink" href="#setup-the-test-s-paths" title="Permalink to this headline">¶</a></h3>
<p>Each regression test is associated with a stage directory and an output directory.
The stage directory will be the working directory of the test and all of its resources will be copied there before running.
The output directory is the directory where some important output files of the test will be kept.
By default these are the generated job script file, the standard output and standard error.
The user can also specify additional files to be kept in the test's specification.
At this phase, all these directories are created.</p>
</div>
<div class="section" id="prepare-a-job-for-the-test">
<span id="prepare-a-job-for-the-test"></span><h3>Prepare a job for the test<a class="headerlink" href="#prepare-a-job-for-the-test" title="Permalink to this headline">¶</a></h3>
<p>At this point a <em>job descriptor</em> will be created for the test. A job descriptor in ReFrame is an abstraction of the job scheduler's functionality relevant to the regression framework.
It is responsible for submitting a job in a job queue and waiting for its completion.
Currently, the ReFrame framework supports three job scheduler backends:</p>
<ul class="simple">
<li><strong>local</strong>, which is basically a <em>pseudo-scheduler</em> that just spawns local OS processes,</li>
<li><strong>nativeslurm</strong>, which is the native <a class="reference external" href="https://slurm.schedmd.com">Slurm</a> job scheduler and</li>
<li><strong>slurm+alps</strong>, which uses <a class="reference external" href="https://slurm.schedmd.com">Slurm</a> for job submission, but uses <a class="reference external" href="http://docs.cray.com/books/S-2529-116//S-2529-116.pdf">Cray's ALPS</a> for launching MPI processes on the compute nodes.</li>
</ul>
</div>
</div>
<div class="section" id="the-compilation-phase">
<span id="the-compilation-phase"></span><h2>2. The Compilation Phase<a class="headerlink" href="#the-compilation-phase" title="Permalink to this headline">¶</a></h2>
<p>At this phase the source code associated with test is compiled with the current programming environment.
Before compiling, all the resources of the test are copied to its stage directory and the compilation is performed from that directory.</p>
</div>
<div class="section" id="the-run-phase">
<span id="the-run-phase"></span><h2>3. The Run Phase<a class="headerlink" href="#the-run-phase" title="Permalink to this headline">¶</a></h2>
<p>This phase comprises two subphases:</p>
<ul class="simple">
<li><strong>Job launch</strong>: At this subphase a job script file for the regression test is generated and submitted to the job scheduler queue.
If the job scheduler for the current partition is the <strong>local</strong> one, a simple wrapper shell script will be generated and will be launched as a local OS process.</li>
<li><strong>Job wait</strong>: At this subphase the job (or local process) launched in the previous subphase is waited for.
This phase is pretty basic: it just checks that the launched job (or local process) has finished.
No check is made of whether the job or process has finished successfully or not.
This is the responsibility of the next pipeline stage.</li>
</ul>
<p>ReFrame currently supports two execution policies:</p>
<ul class="simple">
<li><strong>serial</strong>: In the serial execution policy, these two subphases are performed back-to-back and the framework blocks until the current regression test finishes.</li>
<li><strong>asynchronous</strong>: In the asynchronous execution policy, as soon as the job associated to the current test is launched, ReFrame continues its execution by executing and launching the subsequent test cases.</li>
</ul>
</div>
<div class="section" id="the-sanity-checking-phase">
<span id="the-sanity-checking-phase"></span><h2>4. The Sanity Checking Phase<a class="headerlink" href="#the-sanity-checking-phase" title="Permalink to this headline">¶</a></h2>
<p>At this phase it is determined whether the check has finished successfully or not.
Although this decision is test-specific, ReFrame provides a very flexible and expressive way for specifying complex patterns and operations to be performed on the test's output in order to determine the outcome of the test.</p>
</div>
<div class="section" id="the-performance-checking-phase">
<span id="the-performance-checking-phase"></span><h2>5. The Performance Checking Phase<a class="headerlink" href="#the-performance-checking-phase" title="Permalink to this headline">¶</a></h2>
<p>At this phase the performance of the regression test is checked.
ReFrame uses the same mechanism for analyzing the output of the test as with sanity checking.
The only difference is that the user can now specify reference values per system or system partition, as well as acceptable performance thresholds</p>
</div>
<div class="section" id="the-cleanup-phase">
<span id="the-cleanup-phase"></span><h2>6. The Cleanup Phase<a class="headerlink" href="#the-cleanup-phase" title="Permalink to this headline">¶</a></h2>
<p>This is the final stage of the regression test pipeline and it is responsible for cleaning up the resources of the test.
Three steps are performed in this phase:</p>
<ol class="simple">
<li>The interesting files of the test (job script, standard output and standard error and any additional files specified by the user) are copied to its output directory for later inspection and bookkeeping,</li>
<li>the stage directory is removed and</li>
<li>the test's environment is revoked.</li>
</ol>
<p>At this point the ReFrame's environment is clean and in its original state and the framework may continue by running more test cases.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          
<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial.html" class="btn btn-neutral float-right" title="ReFrame Tutorial" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configure.html" class="btn btn-neutral" title="Configuring ReFrame for Your Site" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, CSCS.
    </p>

    <style type="text/css">
      .cscs_group:after {
        content:"";
        display: table;
        clear: both;
      }
      .cscs_left {
        float: left;
        width: 50%;
      }
      .cscs_right {
        float: right;
        width: 50%;
    }
      @media screen and (max-width: 768px) {
        .cscs_left,
        .cscs_right {
          float: none;
          width: auto;
          margin-bottom: 20px;
        }
      }
    </style>
    <p>
      <div class="cscs_group">
        <div class="cscs_left">
          <strong>CSCS</strong><br />
          <strong>Swiss National Supercomputing Centre</strong><br />
          Via Trevano 131<br />
          6900 Lugano<br />
          Switzerland
        </div>
        <div  class="cscs_right" style="margin-left: auto; margin-right: auto;">
          <a href="http://www.cscs.ch" target="_blank">
            <img id="cscs-cscs-logo" src="../_static/img/logo_cscs.png" style="background-color: transparent; margin-top: 5px;">
          </a>
        </div>
      </div>
    </p>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

  </div>

</footer>
        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: v2.7
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="pipeline.html">v2.7</a></dd>
            <dd><a href="../v2.8/pipeline.html">v2.8</a></dd>
            <dd><a href="../v2.8.1/pipeline.html">v2.8.1</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../master/pipeline.html">master</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>